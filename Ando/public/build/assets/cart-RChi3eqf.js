import{_ as E,r as q,c as F,o as j,a as m,b as s,d as f,w as y,e as I,t as d,F as O,f as R,u as B,g as b,h as x,i as g,j as N}from"./app-Bd3q8yYu.js";const D={name:"UserCart",setup(){const v=B(),t=q([]),p=q(!0),a=q(null),C=q(10),_=F(()=>t.value.reduce((n,i)=>n+i.price*i.quantity,0)),u=F(()=>_.value+C.value),e=n=>!n||isNaN(n)?"0.00":Number(n).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),h=()=>{const n=localStorage.getItem("user_token");return n?(b.defaults.headers.common.Authorization=`Bearer ${n}`,!0):(v.push("/login"),!1)},w=async()=>{var n,i,c,r;if(h())try{p.value=!0,a.value=null;const l=await b.get("/api/user/cart",{headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}});(n=l.data)!=null&&n.success&&Array.isArray(l.data.items)?t.value=l.data.items.map(k=>({...k,price:parseFloat(k.price),quantity:parseInt(k.quantity),stock:parseInt(k.stock)})):(console.error("Invalid cart data structure:",l.data),a.value="Invalid cart data structure received")}catch(l){console.error("Error fetching cart:",l),((i=l.response)==null?void 0:i.status)===401?v.push("/login"):a.value=((r=(c=l.response)==null?void 0:c.data)==null?void 0:r.message)||"Failed to load cart items. Please try again."}finally{p.value=!1}},P=async(n,i)=>{var c,r;if(h())try{p.value=!0,a.value=null,await b.patch(`/api/user/cart/${n}`,{quantity:i},{headers:{Accept:"application/json","Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),await w()}catch(l){console.error("Error updating cart:",l),a.value=((r=(c=l.response)==null?void 0:c.data)==null?void 0:r.message)||"Failed to update cart. Please try again."}finally{p.value=!1}},T=async n=>{var i,c;if(h())try{p.value=!0,a.value=null,await b.delete(`/api/user/cart/${n}`,{headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),await w()}catch(r){console.error("Error removing item:",r),a.value=((c=(i=r.response)==null?void 0:i.data)==null?void 0:c.message)||"Failed to remove item. Please try again."}finally{p.value=!1}},A=async()=>{var n,i,c;if(h()){if(!t.value||t.value.length===0){a.value="Your cart is empty!";return}try{p.value=!0,a.value=null;const r=await b.get("/api/user/cart",{headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}});if((n=r.data)!=null&&n.success&&Array.isArray(r.data.items)){const l=r.data.items,k=l.map(o=>{const S=[];return!o.stock||o.stock===0?S.push("Out of stock"):o.quantity>o.stock&&S.push(`Only ${o.stock} available`),o.available||S.push("No longer available"),{name:o.name,issues:S}}).filter(o=>o.issues.length>0);if(k.length>0){a.value=`The following items have issues:
`+k.map(o=>`${o.name}: ${o.issues.join(", ")}`).join(`
`);return}localStorage.setItem("checkout_data",JSON.stringify({items:l.map(o=>({...o,price:parseFloat(o.price),quantity:parseInt(o.quantity),stock:parseInt(o.stock)})),subtotal:_.value,shipping:C.value,total:u.value,timestamp:new Date().getTime()})),v.push("/user/checkout")}else a.value="Unable to validate cart items. Please try again."}catch(r){console.error("Error proceeding to checkout:",r),a.value=((c=(i=r.response)==null?void 0:i.data)==null?void 0:c.message)||"Failed to proceed to checkout. Please try again."}finally{p.value=!1}}};return j(()=>{w()}),{cartItems:t,loading:p,error:a,subtotal:_,total:u,shippingCost:C,formatPrice:e,updateQuantity:P,removeItem:T,checkout:A,fetchCart:w}}},K={class:"cart-container"},V={class:"header"},X={class:"nav-links"},L={class:"icons"},Q={key:0,class:"badge"},U={key:0,class:"badge"},Y={class:"main-content"},z={class:"cart-section"},H={key:0,class:"loading-state"},J={key:1,class:"error-state"},M={key:2,class:"empty-state"},W={key:3,class:"cart-content"},G={class:"cart-items"},Z={class:"item-image"},$=["src","alt"],tt={class:"item-details"},st={class:"item-category"},at={class:"item-price highlight-orange"},et={class:"item-quantity"},nt=["onClick","disabled"],ot=["onClick","disabled"],rt={class:"item-total highlight-blue"},lt=["onClick"],it={class:"cart-summary card"},ut={class:"summary-row"},ct={class:"summary-row"},dt={class:"summary-row total"},pt={class:"highlight-orange"};function mt(v,t,p,a,C,_){const u=x("router-link");return g(),m("div",K,[s("header",V,[s("div",X,[f(u,{to:{name:"home"}},{default:y(()=>t[3]||(t[3]=[s("b",null,"Home",-1)])),_:1}),f(u,{to:{name:"news"}},{default:y(()=>t[4]||(t[4]=[s("b",null,"New",-1)])),_:1}),f(u,{to:{name:"user-trends"}},{default:y(()=>t[5]||(t[5]=[s("b",null,"Trends",-1)])),_:1}),f(u,{to:{name:"contact"}},{default:y(()=>t[6]||(t[6]=[s("b",null,"Contact",-1)])),_:1})]),t[8]||(t[8]=s("div",{class:"title"},[s("span",{class:"four-point-star"}),I(" Fashion Trend "),s("span",{class:"four-point-star blue"})],-1)),s("div",L,[t[7]||(t[7]=s("i",{class:"fas fa-search"},null,-1)),f(u,{to:{name:"user-wishlist"},class:"fas fa-heart"},{default:y(()=>[v.wishlistCount?(g(),m("span",Q,d(v.wishlistCount),1)):N("",!0)]),_:1}),f(u,{to:{name:"purchase"},class:"fas fa-user"}),f(u,{to:{name:"user-cart"},class:"fas fa-shopping-cart"},{default:y(()=>[a.cartItems.length?(g(),m("span",U,d(a.cartItems.length),1)):N("",!0)]),_:1}),s("i",{class:"fas fa-sign-out-alt",onClick:t[0]||(t[0]=(...e)=>v.logout&&v.logout(...e))})])]),s("main",Y,[s("section",z,[t[23]||(t[23]=s("h2",null,"Shopping Cart",-1)),a.loading?(g(),m("div",H,t[9]||(t[9]=[s("i",{class:"fas fa-spinner fa-spin"},null,-1),s("p",null,"Loading cart...",-1)]))):a.error?(g(),m("div",J,[t[10]||(t[10]=s("i",{class:"fas fa-exclamation-circle"},null,-1)),s("p",null,d(a.error),1),s("button",{onClick:t[1]||(t[1]=(...e)=>a.fetchCart&&a.fetchCart(...e)),class:"action-btn"},"Retry")])):!a.cartItems||a.cartItems.length===0?(g(),m("div",M,[t[12]||(t[12]=s("i",{class:"fas fa-shopping-cart"},null,-1)),t[13]||(t[13]=s("h3",null,"Your cart is empty",-1)),t[14]||(t[14]=s("p",null,"Browse our products and add items to your cart",-1)),f(u,{to:{name:"user-trends"},class:"shop-now-btn"},{default:y(()=>t[11]||(t[11]=[I("Continue Shopping")])),_:1})])):(g(),m("div",W,[s("div",G,[(g(!0),m(O,null,R(a.cartItems,e=>(g(),m("div",{key:e.id,class:"cart-item card"},[s("div",Z,[s("img",{src:e.image_url||"/img/placeholder.png",alt:e.name},null,8,$)]),s("div",tt,[s("h3",null,d(e.name),1),s("p",st,d(e.category),1),s("p",at,"$"+d(a.formatPrice(e.price)),1)]),s("div",et,[s("button",{onClick:h=>a.updateQuantity(e.id,e.quantity-1),disabled:e.quantity<=1,class:"quantity-btn"},t[15]||(t[15]=[s("i",{class:"fas fa-minus"},null,-1)]),8,nt),s("span",null,d(e.quantity),1),s("button",{onClick:h=>a.updateQuantity(e.id,e.quantity+1),disabled:e.quantity>=e.stock,class:"quantity-btn"},t[16]||(t[16]=[s("i",{class:"fas fa-plus"},null,-1)]),8,ot)]),s("div",rt," $"+d(a.formatPrice(e.price*e.quantity)),1),s("button",{onClick:h=>a.removeItem(e.id),class:"remove-btn"},t[17]||(t[17]=[s("i",{class:"fas fa-trash"},null,-1)]),8,lt)]))),128))]),s("div",it,[t[22]||(t[22]=s("h3",null,"Order Summary",-1)),s("div",ut,[t[18]||(t[18]=s("span",null,"Subtotal",-1)),s("span",null,"$"+d(a.formatPrice(a.subtotal)),1)]),s("div",ct,[t[19]||(t[19]=s("span",null,"Shipping",-1)),s("span",null,"$"+d(a.formatPrice(a.shippingCost)),1)]),s("div",dt,[t[20]||(t[20]=s("span",null,"Total",-1)),s("span",pt,"$"+d(a.formatPrice(a.total)),1)]),s("button",{onClick:t[2]||(t[2]=(...e)=>a.checkout&&a.checkout(...e)),class:"checkout-btn"}," Proceed to Checkout "),f(u,{to:{name:"user-trends"},class:"continue-shopping-btn"},{default:y(()=>t[21]||(t[21]=[I(" Continue Shopping ")])),_:1})])]))])])])}const gt=E(D,[["render",mt],["__scopeId","data-v-894015b1"]]);export{gt as default};
